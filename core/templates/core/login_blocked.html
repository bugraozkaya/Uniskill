{% extends 'core/base.html' %}

{% block content %}
<div class="container d-flex align-items-center justify-content-center" style="min-height: 70vh;">
    <div class="col-md-6">
        <div class="card p-5 border-0 shadow-lg rounded-4 text-center">
            <div class="mb-4">
                <div class="display-1 text-danger animate__animated animate__pulse animate__infinite">
                    <i class="fas fa-user-shield"></i>
                </div>
            </div>
            
            <h2 class="fw-bold text-dark mb-3">Access Denied</h2>
            <p class="text-muted mb-4">
                Too many failed login attempts detected. For security reasons, your access has been temporarily restricted.
            </p>
            
            <div id="status-container" class="alert alert-warning border-0 rounded-3 py-3 mb-4">
                <i class="fas fa-hourglass-half me-2"></i>
                Please wait <strong id="timer">{{ remaining }}</strong> seconds. 
                <br>
                <small class="opacity-75">You will be redirected automatically.</small>
            </div>
            
            <div class="d-grid gap-2">
                <a href="/" class="btn btn-light rounded-pill fw-semibold py-2">
                    <i class="fas fa-home me-2"></i>Return Home
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // Get the duration from the 'remaining' variable passed from the Backend
    // If no data is provided, default to 30 seconds.
    let timeLeft = {{ remaining|default:30 }}; 
    
    const timerElement = document.getElementById('timer');
    const statusContainer = document.getElementById('status-container');

    const countdown = setInterval(() => {
        timeLeft--;
        if (timerElement) {
            timerElement.innerText = timeLeft;
        }

        // When time is up
        if (timeLeft <= 0) {
            clearInterval(countdown);
            
            // Inform the user
            statusContainer.className = "alert alert-success border-0 rounded-3 py-3 mb-4 animate__animated animate__fadeIn";
            statusContainer.innerHTML = '<i class="fas fa-check-circle me-2"></i> <strong>Time is up!</strong> Redirecting...';
            
            // REDIRECT after 1.5 seconds (Go to next_url provided by the View)
            setTimeout(() => {
                window.location.href = "{{ next_url|default:'/login/' }}";
            }, 1500);
        }
    }, 1000);
</script>

<style>
    /* For a small pulse effect */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    .animate__pulse {
        animation: pulse 2s infinite;
    }
</style>
{% endblock %}